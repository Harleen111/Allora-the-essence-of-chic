<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Allora Chatbot</title>
     <style>
        body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
}

#chatIcon {
    width: 50px;
    height: 50px;
    background-color: #ff4da6;
    border-radius: 50%;
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

#chatIcon img {
    width: 30px;
    height: 30px;
}

#chatContainer {
    width: 300px;
    position: fixed;
    bottom: 20px;
    right: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    background: white;
    overflow: hidden;
    display: none; /* Initially hidden */
}

#chatHeader {
    background-color: #ff4da6;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#chatHeader img {
    width: 20px;
    height: 20px;
}

#closeChat {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

#chatBody {
    height: 200px;
    overflow-y: auto;
    padding: 10px;
}

#chatInputContainer {
    display: flex;
    border-top: 1px solid #ddd;
}

#chatInput {
    flex: 1;
    border: none;
    padding: 10px;
    outline: none;
}

#sendButton {
    background: #ff4da6;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
}

#sendButton:hover {
    background: #e60073;
}

#chatInput:focus {
    border: 2px solid #ff4da6;
}

#sendButton:active {
    background: #b30059;
}
     </style>
 </head>
 <body>
 
     <!-- Chat Icon (Initially shown) -->
     <div id="chatIcon" onclick="toggleChat()">
         <img src="chatbot.png" alt="Chat Icon">
     </div>
 
     <!-- Chat Window (Initially hidden) -->
     <div id="chatContainer">
         <div id="chatHeader">
            <img src="chatbot.png" alt="Chat Icon">
            How may we help you?
             <button id="closeChat" onclick="toggleChat()">âœ–</button>
         </div>
         <div id="chatBody">Welcome to Allora! How can I assist you?</div>
         <div id="chatInputContainer">
             <input type="text" id="chatInput" placeholder="Type a message...">
             <button id="sendButton">Send</button>
         </div>
     </div>
 
     <script >
        document.addEventListener("DOMContentLoaded", function () {
    const chatBody = document.getElementById("chatBody");
    const chatInput = document.getElementById("chatInput");
    const sendButton = document.getElementById("sendButton");
    const chatContainer = document.getElementById("chatContainer");
    const chatIcon = document.getElementById("chatIcon");

    function sendMessage() {
        let userMessage = chatInput.value.trim();
        if (userMessage === "") return;

        // Disable send button while processing
        sendButton.disabled = true;

        // Display user message
        let userMsgElem = document.createElement("p");
        userMsgElem.innerHTML = `<strong>You:</strong> ${userMessage}`;
        chatBody.appendChild(userMsgElem);

        // Send to backend
        fetch("/ask", {
            method: "POST",
            body: JSON.stringify({ message: userMessage }),
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.json())
        .then(data => {
            let botMsgElem = document.createElement("p");
            botMsgElem.innerHTML = `<strong>Allora Bot:</strong> ${data.reply}`;
            botMsgElem.style.color = "#007bff";
            chatBody.appendChild(botMsgElem);

            // Scroll to the bottom after the bot's message is added
            setTimeout(() => {
                chatBody.scrollTop = chatBody.scrollHeight;
                sendButton.disabled = false;  // Re-enable send button after processing
            }, 10);
        })
        .catch(error => {
            console.error("Error:", error);
            let errorElem = document.createElement("p");
            errorElem.innerHTML = `<strong>Allora Bot:</strong> Oops! Something went wrong. Please try again later.`;
            errorElem.style.color = "red";
            chatBody.appendChild(errorElem);
            sendButton.disabled = false;  // Re-enable send button in case of error
        });

        // Clear input and focus on the input field
        chatInput.value = "";
        chatInput.focus();
    }

    // Send message on click or pressing Enter
    sendButton.addEventListener("click", sendMessage);
    chatInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") sendMessage();
    });

    // Toggle chat window visibility
    window.toggleChat = function() {
        chatContainer.style.display = chatContainer.style.display === "none" ? "block" : "none";
        chatIcon.style.display = chatContainer.style.display === "none" ? "flex" : "none";
    };
});
     </script>
 
 </body>
 </html>